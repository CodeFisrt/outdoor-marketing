<div class="inventory-map-container">
  <!-- Top Navigation Bar -->
  <nav class="map-navbar">
    <div class="navbar-left">
      <h1 class="navbar-logo">AdOnStreet</h1>
      <span class="navbar-subtitle">Outdoor Advertising Inventory</span>
    </div>
    <div class="navbar-right">
      <button class="nav-btn" (click)="toggleSidebar()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </button>
    </div>
  </nav>

  <!-- Left Sidebar -->
  <aside class="sidebar" [class.open]="sidebarOpen">
    <!-- Explore Panel -->
    <div class="sidebar-panel explore-panel">
      <div class="panel-tabs">
        <button class="tab-btn" [class.active]="activeTab === 'trending'" (click)="activeTab = 'trending'">
          Trending
        </button>
        <button class="tab-btn" [class.active]="activeTab === 'disruptions'" (click)="activeTab = 'disruptions'">
          Disruptions
        </button>
      </div>

      <div class="panel-content" *ngIf="activeTab === 'trending'">
        <div class="trending-list">
          <div class="trending-item" *ngFor="let item of trendingItems; let i = index"
            (click)="showPopup(item, [item.longitude, item.latitude])">
            <div class="trending-rank">{{ i + 1 }}</div>
            <div class="trending-info">
              <div class="trending-name">{{ item.name || 'Unnamed' }}</div>
              <div class="trending-location">{{ item.city }}, {{ item.area }}</div>
              <div class="trending-meta">
                <span class="trending-type">{{ getMediaTypeLabel(item.mediaType) }}</span>
                <span class="trending-score">Score: {{ item.trafficScore }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="panel-content" *ngIf="activeTab === 'disruptions'">
        <div class="disruptions-list">
          <div class="disruption-item" *ngFor="let item of filteredInventory | slice:0:5">
            <div class="disruption-icon">⚠️</div>
            <div class="disruption-info">
              <div class="disruption-name">{{ item.properties.name }}</div>
              <div class="disruption-status">{{ item.properties.availabilityStatus }}</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Map Focus Panel -->
    <div class="sidebar-panel map-focus-panel">
      <h3 class="panel-title">Map Focus</h3>
      <div class="focus-options">
        <label class="focus-option">
          <input type="radio" name="mapMode" value="all" [checked]="mapMode === 'all'" (change)="setMapMode('all')">
          <span>All Traffic</span>
        </label>
        <label class="focus-option">
          <input type="radio" name="mapMode" value="digital_only" [checked]="mapMode === 'digital_only'"
            (change)="setMapMode('digital_only')">
          <span>Only Digital Screens</span>
        </label>
        <label class="focus-option">
          <input type="radio" name="mapMode" value="high_traffic" [checked]="mapMode === 'high_traffic'"
            (change)="setMapMode('high_traffic')">
          <span>High-Traffic Hoardings</span>
        </label>
        <label class="focus-option">
          <input type="radio" name="mapMode" value="available" [checked]="mapMode === 'available'"
            (change)="setMapMode('available')">
          <span>Available Now</span>
        </label>
        <label class="focus-option">
          <input type="radio" name="mapMode" value="maintenance" [checked]="mapMode === 'maintenance'"
            (change)="setMapMode('maintenance')">
          <span>Under Maintenance</span>
        </label>
      </div>
    </div>

    <!-- Filters Panel -->
    <div class="sidebar-panel filters-panel">
      <h3 class="panel-title">Filters</h3>

      <!-- Search -->
      <div class="filter-group">
        <label class="filter-label">Search</label>
        <input type="text" class="filter-input" placeholder="Code, Area, Landmark..." [(ngModel)]="searchQuery"
          (input)="onFilterChange()">
      </div>

      <!-- Media Type -->
      <div class="filter-group">
        <label class="filter-label">Media Type</label>
        <select class="filter-select" [(ngModel)]="selectedMediaType" (change)="onFilterChange()">
          <option *ngFor="let type of mediaTypes" [value]="type.value">
            {{ type.label }}
          </option>
        </select>
      </div>

      <!-- City -->
      <div class="filter-group">
        <label class="filter-label">City</label>
        <select class="filter-select" [(ngModel)]="selectedCity" (change)="onFilterChange()">
          <option value="">All Cities</option>
          <option *ngFor="let city of cities" [value]="city">
            {{ city }}
          </option>
        </select>
      </div>

      <!-- Availability -->
      <div class="filter-group">
        <label class="filter-label">Availability</label>
        <select class="filter-select" [(ngModel)]="selectedAvailability" (change)="onFilterChange()">
          <option *ngFor="let opt of availabilityOptions" [value]="opt.value">
            {{ opt.label }}
          </option>
        </select>
      </div>

      <!-- Visibility -->
      <div class="filter-group">
        <label class="filter-label">Visibility (Traffic Rating)</label>
        <select class="filter-select" [(ngModel)]="selectedVisibility" (change)="onFilterChange()">
          <option *ngFor="let opt of visibilityOptions" [value]="opt.value">
            {{ opt.label }}
          </option>
        </select>
      </div>

      <!-- Clear Filters -->
      <button class="clear-filters-btn" (click)="clearFilters()">
        Clear All Filters
      </button>
    </div>
  </aside>

  <!-- Map Container -->
  <div class="map-wrapper">
    <div id="inventory-map" class="inventory-map"></div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" *ngIf="isLoading">
      <div class="spinner"></div>
      <p>Loading inventory...</p>
    </div>

    <!-- Map Mode Toggle (Top Right) -->
    <div class="map-mode-toggle">
      <button class="mode-btn" [class.active]="mapMode === 'all'" (click)="setMapMode('all')" title="All Inventory">
        All
      </button>
      <button class="mode-btn" [class.active]="mapMode === 'digital_only'" (click)="setMapMode('digital_only')"
        title="Digital Screens Only">
        Digital
      </button>
      <button class="mode-btn" [class.active]="mapMode === 'high_traffic'" (click)="setMapMode('high_traffic')"
        title="High Traffic">
        High Traffic
      </button>
      <button class="mode-btn" [class.active]="mapMode === 'available'" (click)="setMapMode('available')"
        title="Available Now">
        Available
      </button>
      <button class="mode-btn" [class.active]="mapMode === 'maintenance'" (click)="setMapMode('maintenance')"
        title="Under Maintenance">
        Maintenance
      </button>
      <button class="mode-btn" [class.active]="mapMode === 'heatmap'"
        (click)="setMapMode('heatmap'); showHeatmap = !showHeatmap; toggleHeatmap()" title="Heatmap View">
        Heatmap
      </button>
    </div>

    <!-- Booking Calendar Modal -->
    <div class="booking-modal" *ngIf="showBookingCalendar" (click)="closeBookingCalendar()">
      <div class="booking-modal-content" (click)="$event.stopPropagation()">
        <div class="booking-modal-header">
          <h3>Booking Calendar - {{ selectedInventoryForBooking?.name }}</h3>
          <button class="close-btn" (click)="closeBookingCalendar()">×</button>
        </div>
        <div class="booking-modal-body">
          <div class="booking-form">
            <h4>Create New Booking</h4>
            <div class="form-group">
              <label>Start Date</label>
              <input type="date" [(ngModel)]="bookingStartDate" class="form-control">
            </div>
            <div class="form-group">
              <label>End Date</label>
              <input type="date" [(ngModel)]="bookingEndDate" class="form-control">
            </div>
            <button class="btn btn-primary" (click)="createBooking()"
              [disabled]="!bookingStartDate || !bookingEndDate || !isDateRangeAvailable(bookingStartDate, bookingEndDate)">
              Create Booking
            </button>
            <div *ngIf="bookingStartDate && bookingEndDate && !isDateRangeAvailable(bookingStartDate, bookingEndDate)"
              class="alert alert-warning">
              Date range conflicts with existing bookings
            </div>
          </div>
          <div class="bookings-list">
            <h4>Existing Bookings</h4>
            <div *ngIf="bookings.length === 0" class="no-bookings">
              No bookings found
            </div>
            <div *ngFor="let booking of bookings" class="booking-item">
              <div class="booking-dates">
                <strong>{{ booking.start_date }}</strong> to <strong>{{ booking.end_date }}</strong>
              </div>
              <div class="booking-status">
                Status: <span [class]="'status-' + booking.status">{{ booking.status }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>